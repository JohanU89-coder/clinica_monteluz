<div class="page-container">
  <header class="page-header">
    <h1>Configuraci贸n de Cuenta</h1>
    <p>Gestiona tu informaci贸n personal y profesional.</p>
  </header>

  <div class="profile-layout" *ngIf="authService.userProfile() as profile">
    
    <div class="profile-card fade-in">
      
      <div class="card-cover"></div>
      
      <div class="card-content">
        <div class="avatar-container">
          <div class="avatar" [style.background-color]="getAvatarColor(profile.full_name)">
            {{ getInitials(profile.full_name) }}
          </div>
          <div class="role-badge" [class.doctor]="profile.role === 'doctor'">
            {{ profile.role === 'doctor' ? 'Personal M茅dico' : 'Paciente' }}
          </div>
        </div>

        <ng-container *ngIf="!isEditing()">
          <div class="info-section text-center">
            <h2>{{ profile.full_name }}</h2>
            <p class="email-text">{{ profile.email }}</p>
          </div>

          <div class="details-grid">
            <div class="detail-box">
              <span class="label">Miembro Desde</span>
              <span class="value">{{ profile.created_at | date:'MMMM yyyy':'':'es-PE' | titlecase }}</span>
            </div>
            
            <ng-container *ngIf="profile.role === 'doctor'">
              <div class="detail-box">
                <span class="label">Especialidad</span>
                <span class="value">{{ profile.specialties?.name || 'General' }}</span>
              </div>
              <div class="detail-box">
                <span class="label">Licencia M茅dica</span>
                <span class="value">{{ profile.license_number || '---' }}</span>
              </div>
            </ng-container>
          </div>

          <div class="card-actions">
            <button class="btn-primary" (click)="toggleEdit(true)">
              Editar Informaci贸n
            </button>
          </div>
        </ng-container>

        <ng-container *ngIf="isEditing()">
          <form [formGroup]="profileForm" (ngSubmit)="saveProfile()" class="edit-form">
            
            <div class="form-group">
              <label>Nombre Completo</label>
              <input type="text" formControlName="full_name" placeholder="Tu nombre legal">
            </div>

            <ng-container *ngIf="profile.role === 'doctor'">
              <div class="form-group">
                <label>N煤mero de Licencia (CMP)</label>
                <input type="text" formControlName="license_number" placeholder="Ej: 123456">
              </div>
            </ng-container>

            <div class="edit-actions">
              <button type="button" class="btn-secondary" (click)="toggleEdit(false)">Cancelar</button>
              <button type="submit" class="btn-save" [disabled]="profileForm.invalid">Guardar Cambios</button>
            </div>
          </form>
        </ng-container>

      </div>
    </div>

    <div class="security-info fade-in">
      <h3>Seguridad de la Cuenta</h3>
      <div class="info-row">
        <div class="icon"></div>
        <div>
          <h4>Contrase帽a</h4>
          <p>Gestionada de forma segura a trav茅s de Supabase Auth.</p>
        </div>
      </div>
      <div class="info-row">
        <div class="icon"></div>
        <div>
          <h4>Verificaci贸n</h4>
          <p>Tu correo {{ profile.email }} est谩 verificado.</p>
        </div>
      </div>
    </div>

  </div>
</div>